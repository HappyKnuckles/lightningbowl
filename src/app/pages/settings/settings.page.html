<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Settings</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-list>
    <ion-item>
      <ion-icon name="person-circle-outline" slot="start"></ion-icon>
      <ion-input
        class="ion-text-right"
        label="Your name"
        type="text"
        [value]="userService.username()"
        placeholder="{{ userService.username() }}"
        (ionChange)="changeName($event)"
        style="margin-right: 21px">
      </ion-input>
    </ion-item>
    <ion-item>
      <ion-icon name="color-palette-outline" slot="start"></ion-icon>
      <ion-select
        label="Color Theme"
        interface="popover"
        [(ngModel)]="currentColor"
        [ngClass]="currentColor?.toLowerCase()"
        placeholder="{{ currentColor }}"
        (ionChange)="changeColor()">
        <ion-select-option *ngFor="let color of optionsWithClasses; let i = index" [value]="color.name" [ngClass]="color.class">
          {{ color.name }}
        </ion-select-option>
      </ion-select>
    </ion-item>

    <ion-item>
      <ion-icon name="bowling-ball-outline" slot="start"></ion-icon>
      <ion-select
        label="Pin Input Mode"
        interface="action-sheet"
        [value]="storageService.pinInputMode() ? 'hit' : 'missing'"
        (ionChange)="savePinInputMode($event.detail.value)">
        <ion-select-option value="missing">Missing Pins</ion-select-option>
        <ion-select-option value="hit">Hit Pins</ion-select-option>
      </ion-select>
    </ion-item>

    <app-league-selector></app-league-selector>

    <ion-item button id="spare-names-modal">
      <ion-icon src="/assets/svg/pin.svg" slot="start"></ion-icon>
      <ion-label>Spare Names</ion-label>
    </ion-item>

    <ion-item>
      <ion-icon src="/assets/svg/target-82-svgrepo-com.svg" slot="start"></ion-icon>
      <ion-input
        label="Goal Average"
        class="ion-text-right"
        (ionChange)="getGameCountForAverage($event)"
        placeholder="230"
        max="300"
        inputmode="numeric"
        type="number"
        clearOnEdit="true"></ion-input>
    </ion-item>

    <!-- Issues & Features Section -->
    <ion-item button id="github-issues-modal">
      <ion-icon name="bug-outline" slot="start"></ion-icon>
      <ion-label>Issues & Features</ion-label>
    </ion-item>

    <ion-item id="feedback-modal" class="ion-activatable ripple-parent rectangle">
      <ion-icon name="mail-outline" slot="start"></ion-icon>
      <ion-label>Feedback/Requests</ion-label>
      <p class="link">Open form</p>
    </ion-item>

    <ion-item button (click)="openSyncModal()">
      <ion-icon name="cloud-upload-outline" slot="start"></ion-icon>
      <ion-label>Cloud Sync</ion-label>
      @if (cloudSyncService.syncStatus().lastSync) {
        <ion-note slot="end">Last sync: {{ cloudSyncService.syncStatus().lastSync | date: "short" }}</ion-note>
      }
    </ion-item>

    <ion-item (click)="updateApp()" button [detail]="false" *ngIf="updateAvailable">
      <ion-icon name="refresh-circle-outline" slot="start"></ion-icon>
      <ion-label>Load update</ion-label>
      <ion-button slot="end"> Update </ion-button>
    </ion-item>
  </ion-list>

  @if (isTestEnvironment) {
    <div style="text-align: center; margin-top: 90%; color: gray; font-size: 13px">This is the test server. Used for experimental features.</div>
  }
</ion-content>

<ion-modal trigger="spare-names-modal" #spareNamesModal>
  <ng-template>
    <ion-header [translucent]="true">
      <ion-toolbar>
        <ion-buttons slot="start" style="padding: 4px">
          <ion-button color="medium" (click)="spareNamesModal.dismiss()">
            <ion-icon name="chevron-back"></ion-icon>
          </ion-button>
        </ion-buttons>
        <ion-title>Spare Names</ion-title>
      </ion-toolbar>
    </ion-header>
    <ion-content [fullscreen]="true">
      <app-spare-names></app-spare-names>
    </ion-content>
  </ng-template>
</ion-modal>

<ion-modal trigger="github-issues-modal" #githubIssuesModal>
  <ng-template>
    <app-github-issues-modal [modal]="githubIssuesModal"></app-github-issues-modal>
  </ng-template>
</ion-modal>

<ion-modal trigger="feedback-modal" #feedback [keepContentsMounted]="true">
  <ng-template>
    <ion-header [translucent]="true">
      <ion-toolbar>
        <ion-buttons slot="start">
          <ion-button color="medium" (click)="feedback.dismiss()">Cancel</ion-button>
        </ion-buttons>
        <ion-title>Feedback/Request</ion-title>
      </ion-toolbar>
    </ion-header>
    <ion-content>
      <ion-card>
        <ion-card-header>
          <ion-card-title>Contact Us</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <form #feedbackForm="ngForm" (ngSubmit)="submitFeedback(feedbackForm)">
            <ion-item>
              <ion-input
                label="Your email"
                pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+.[a-zA-Z]{2,4}$"
                labelPlacement="floating"
                type="email"
                placeholder="email@domain.com"
                errorText="Invalid email address."
                [(ngModel)]="userEmail"
                name="userEmail"
                required></ion-input>
            </ion-item>

            <ion-item>
              <ion-textarea
                maxlength="500"
                counter="true"
                label="Feedback"
                labelPlacement="floating"
                placeholder="Enter your feedback"
                [(ngModel)]="feedbackMessage"
                name="feedbackMessage"
                [autoGrow]="true"
                required
                #feedbackInput="ngModel"
                errorText="Feedback is required."></ion-textarea>
            </ion-item>

            <ion-button expand="full" color="primary" type="submit" [disabled]="feedbackForm.invalid"> Submit Feedback </ion-button>
          </form>
        </ion-card-content>
      </ion-card>
    </ion-content>
  </ng-template>
</ion-modal>
